graph TB
    subgraph "ðŸŽ¨ Frontend - Sistema de AutenticaciÃ³n"
        subgraph "ðŸŒ Opciones de Login"
            LOGIN_LOCAL[ðŸ“ Login Local]
            LOGIN_OAUTH[ðŸŒ Login Google OAuth2]
            REGISTER[ðŸ“ Registro Simple]
        end
        
        subgraph "ðŸ”‘ Procesamiento Frontend"
            VALIDATE_FORM[âœ”ï¸ Validar formulario]
            SEND_CREDENTIALS[ðŸ“¤ Enviar credenciales]
            REDIRECT_GOOGLE[ðŸ”„ Redirigir a Google]
            EXTRACT_PARAMS[ðŸ“‹ Extraer parÃ¡metros URL]
            STORE_TOKEN[ðŸ’¾ Guardar en localStorage]
            EXTRACT_USER[ðŸ‘¤ Extraer datos usuario]
        end
        
        subgraph "ðŸ›¡ï¸ ProtecciÃ³n de Rutas"
            AUTH_GUARD[ðŸ›¡ï¸ Guard de autenticaciÃ³n]
            ADMIN_GUARD[ðŸ‘‘ Guard de admin]
            REDIRECT_LOGIN[ðŸ”„ Redirigir a login]
            ACCESS_GRANTED[âœ… Acceso concedido]
        end
        
        subgraph "ðŸ“¡ Interceptor HTTP"
            ATTACH_TOKEN[ðŸ”— Adjuntar token]
            HANDLE_401[âŒ Manejar 401]
            AUTO_LOGOUT[ðŸšª Logout automÃ¡tico]
        end
    end
    
    subgraph "ðŸ–¥ï¸ Backend - Procesamiento de AutenticaciÃ³n"
        subgraph "ðŸ” Endpoints de Auth"
            API_LOGIN[POST /api/users/login]
            API_OAUTH_URL[GET /api/users/oauth2/login-url]
            API_OAUTH_CALLBACK[OAuth2 Callback]
            API_REGISTER[POST /api/users/simple-register]
        end
        
        subgraph "ðŸ”‘ Procesamiento Backend"
            VERIFY_CREDENTIALS[ðŸ” Verificar credenciales]
            GENERATE_JWT[ðŸ”‘ Generar JWT]
            EXCHANGE_CODE[ðŸ”„ Intercambiar cÃ³digo OAuth]
            CREATE_USER[ðŸ‘¤ Crear/buscar usuario]
            VALIDATE_JWT[âœ”ï¸ Validar JWT]
            SET_SECURITY_CONTEXT[ðŸ›¡ï¸ Establecer SecurityContext]
            CHECK_PERMISSIONS[ðŸ” Verificar permisos]
        end
    end
    
    subgraph "ðŸŒ Servicios Externos"
        GOOGLE_OAUTH[ðŸŒ Google OAuth2]
        DATABASE[(ðŸ—„ï¸ Base de Datos)]
    end
    
    %% Flujo Login Local
    LOGIN_LOCAL --> VALIDATE_FORM
    VALIDATE_FORM --> SEND_CREDENTIALS
    SEND_CREDENTIALS --> API_LOGIN
    API_LOGIN --> VERIFY_CREDENTIALS
    VERIFY_CREDENTIALS --> DATABASE
    DATABASE --> GENERATE_JWT
    GENERATE_JWT --> STORE_TOKEN
    
    %% Flujo OAuth2
    LOGIN_OAUTH --> REDIRECT_GOOGLE
    REDIRECT_GOOGLE --> API_OAUTH_URL
    API_OAUTH_URL --> GOOGLE_OAUTH
    GOOGLE_OAUTH --> API_OAUTH_CALLBACK
    API_OAUTH_CALLBACK --> EXCHANGE_CODE
    EXCHANGE_CODE --> GOOGLE_OAUTH
    GOOGLE_OAUTH --> CREATE_USER
    CREATE_USER --> DATABASE
    DATABASE --> GENERATE_JWT
    GENERATE_JWT --> EXTRACT_PARAMS
    EXTRACT_PARAMS --> STORE_TOKEN
    
    %% Flujo Registro
    REGISTER --> VALIDATE_FORM
    VALIDATE_FORM --> API_REGISTER
    API_REGISTER --> CREATE_USER
    
    %% GestiÃ³n de SesiÃ³n y Seguridad
    STORE_TOKEN --> EXTRACT_USER
    EXTRACT_USER --> AUTH_GUARD
    AUTH_GUARD --> ADMIN_GUARD
    ADMIN_GUARD --> ACCESS_GRANTED
    ACCESS_GRANTED --> ATTACH_TOKEN
    
    %% Interceptor y ValidaciÃ³n
    ATTACH_TOKEN --> VALIDATE_JWT
    VALIDATE_JWT --> SET_SECURITY_CONTEXT
    SET_SECURITY_CONTEXT --> CHECK_PERMISSIONS
    CHECK_PERMISSIONS --> |âœ… Autorizado| ACCESS_GRANTED
    CHECK_PERMISSIONS --> |âŒ No autorizado| HANDLE_401
    HANDLE_401 --> AUTO_LOGOUT
    AUTO_LOGOUT --> REDIRECT_LOGIN
    
    %% Estilos
    classDef frontend fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef backend fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef external fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    
    class LOGIN_LOCAL,LOGIN_OAUTH,REGISTER,VALIDATE_FORM,SEND_CREDENTIALS,REDIRECT_GOOGLE,EXTRACT_PARAMS,STORE_TOKEN,EXTRACT_USER,AUTH_GUARD,ADMIN_GUARD,REDIRECT_LOGIN,ACCESS_GRANTED,ATTACH_TOKEN,HANDLE_401,AUTO_LOGOUT frontend
    
    class API_LOGIN,API_OAUTH_URL,API_OAUTH_CALLBACK,API_REGISTER,VERIFY_CREDENTIALS,GENERATE_JWT,EXCHANGE_CODE,CREATE_USER,VALIDATE_JWT,SET_SECURITY_CONTEXT,CHECK_PERMISSIONS backend
    
    class GOOGLE_OAUTH,DATABASE external
