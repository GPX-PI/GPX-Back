sequenceDiagram
    participant U as Usuario
    participant F as Frontend
    participant B as Backend
    participant G as Google OAuth2
    participant DB as Base de Datos
    
    Note over U,DB: Registro OAuth2 Simplificado
    U->>F: Clic "Iniciar sesión con Google"
    F->>B: GET /api/users/oauth2/login-url
    B-->>F: {loginUrl: "/oauth2/authorization/google"}
    
    F->>B: Redirige a /oauth2/authorization/google
    B->>G: Redirige con client_id y scopes
    G-->>U: Pantalla de consentimiento
    U->>G: Concede permisos (email, profile)
    G->>B: Callback con código de autorización
    B->>G: Intercambiar código por token
    G-->>B: Access token + datos del usuario
    
    Note over U,DB: Procesamiento simplificado
    B->>B: OAuth2Service.processOAuth2User()
    B->>DB: Buscar usuario por email
    
    alt Usuario existente
        DB-->>B: Usuario encontrado
        B->>B: Actualizar googleId si es necesario
    else Usuario nuevo
        B->>B: Crear usuario con datos mínimos
        Note right of B: Solo: email, firstName, lastName, picture, googleId
        B->>DB: Guardar usuario básico
    end
    
    B->>B: Verificar si perfil está completo
    Note right of B: Requiere: identification, phone, role
    
    B->>F: Redirige con token + profileComplete=false
    Note right of B: URL incluye profileComplete y firstName
    
    F->>F: Extraer parámetros de callback
    
    alt Perfil completo
        F->>F: Redirigir a dashboard
        F-->>U: Acceso completo a la aplicación
    else Perfil incompleto
        F->>F: Redirigir a completar perfil
        F-->>U: Formulario de completar perfil
        
        Note over U,DB: Completar información básica
        U->>F: Llenar datos esenciales
        F->>B: POST /api/users/{id}/complete-profile
        B->>DB: Actualizar usuario con datos básicos
        DB-->>B: Usuario actualizado
        B-->>F: Perfil completado exitosamente
        F->>F: Redirigir a dashboard
        F-->>U: Acceso completo a la aplicación
    end
    
    Note over U,DB: Uso normal de la aplicación
    U->>F: Navegar por la aplicación
    F->>B: Requests con Authorization: Bearer JWT
    B->>B: Validar token JWT
    B-->>F: Respuestas autorizadas 