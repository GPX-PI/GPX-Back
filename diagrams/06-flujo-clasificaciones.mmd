sequenceDiagram
    participant A as Admin
    participant SRC as StageResultController
    participant SRS as StageResultService
    participant DB as Database
    
    Note over A,DB: Obtener clasificación por etapa
    A->>SRC: GET /api/stage-results/clasificacion/stage/{id}
    SRC->>SRS: getClasificacionPorStage(stageId)
    SRS->>DB: Consultar resultados de etapa
    DB-->>SRS: Lista de resultados
    SRS-->>SRC: ClasificacionCompletaDTO[]
    SRC-->>A: Clasificación de etapa
    
    Note over A,DB: Obtener clasificación general
    A->>SRC: GET /api/stage-results/clasificacion/event/{id}
    SRC->>SRS: getClasificacionGeneral(eventId)
    SRS->>DB: Consultar todos los resultados
    DB-->>SRS: Resultados completos
    SRS->>SRS: Calcular tiempos totales
    SRS-->>SRC: ClasificacionCompletaDTO[]
    SRC-->>A: Clasificación general
    
    Note over A,DB: Aplicar penalización
    A->>SRC: PUT /api/stage-results/{id}/penalty
    SRC->>SRS: aplicarPenalizacion(id, penalty)
    SRS->>DB: Actualizar resultado
    DB-->>SRS: Confirmación
    SRS-->>SRC: Resultado actualizado
    SRC-->>A: 200 OK 